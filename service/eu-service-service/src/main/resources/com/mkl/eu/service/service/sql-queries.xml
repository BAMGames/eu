<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <entry key="income.NationalProvinces">
        <![CDATA[
			select
				p.NAME as PROVINCE,
				peu.INCOME as INCOME
			from r_province_eu peu
				inner join r_province p on peu.id = p.id
			where R_COUNTRY = ':countryName'
				and  p.name not in
					(select
						s.R_PROVINCE
					from counter c
						inner join stack s on c.ID_STACK = s.id
					where c.R_COUNTRY <> ':countryName'
						and s.ID_GAME = :idGame
						and (c.TYPE = 'OWN' or c.type = 'CONTROL')
					)
			;
		]]>
    </entry>
    <entry key="income.OwnedProvinces">
        <![CDATA[
			select
				s.R_PROVINCE as PROVINCE,
				peu.income as INCOME
			from counter c
				inner join stack s on c.ID_STACK = s.id
				inner join r_province p on p.name = s.r_province
				inner join r_province_eu peu on peu.id = p.id
			where c.R_COUNTRY = ':countryName'
				and s.ID_GAME = :idGame
				and c.type = 'OWN'
				and s.R_PROVINCE not in
					(select
						s2.R_PROVINCE
					from counter c2
						inner join stack s2 on c2.ID_STACK = s2.id
					where c2.R_COUNTRY <> ':countryName'
						and s2.ID_GAME = :idGame
						and c2.type = 'CONTROL'
					)
			;
		]]>
    </entry>
    <entry key="income.PillagedProvinces">
        <![CDATA[
			select
				s.R_PROVINCE as PROVINCE
			from counter c
				inner join stack s on c.ID_STACK = s.id
			where (c.TYPE = 'REVOLT_MINUS'
					OR c.TYPE = 'REVOLT_PLUS'
					OR c.TYPE = 'PILLAGE_MINUS'
					OR c.TYPE = 'PILLAGE_PLUS'
					OR c.TYPE = 'SIEGEWORK_MINUS')
				AND s.ID_GAME = :idGame
				AND s.R_PROVINCE in :provinceNames
			;
		]]>
    </entry>
	<entry key="income.mnu">
		<![CDATA[
			select
				sum(m.value)
			from counter c
				inner join stack s on c.ID_STACK = s.ID
				inner join t_mnu m on m.R_COUNTRY = c.R_COUNTRY and m.TYPE = c.TYPE
			where s.ID_GAME = :idGame
				AND c.R_COUNTRY = ':countryName'
				AND s.R_PROVINCE not in :provinceNames
			;
		]]>
	</entry>
	<entry key="income.innergold">
		<![CDATA[
			select
				sum(t.value)
			from t_gold t
			where t.R_PROVINCE in :provinceNames;
		]]>
	</entry>
	<entry key="income.outergold">
		<![CDATA[
			select
				20 * count(*)
			from counter c
				inner join stack s on c.ID_STACK = s.ID
			where s.ID_GAME = :idGame
				AND s.R_PROVINCE in :provinceNames
				AND c.TYPE = 'GOLD_MINE'
			;
		]]>
	</entry>
	<entry key="income.tflevels">
		<![CDATA[
			select
				sum(tf.level * IF(tz.TYPE = 'ZP', 2, 1))
			from trade_fleet tf
				inner join r_province p on tf.R_PROVINCE = p.NAME
				inner join R_PROVINCE_TZ tz on tz.ID = p.ID
			where tf.R_COUNTRY = ':countryName'
				AND tf.ID_GAME = :idGame
		;
		]]>
	</entry>
	<entry key="income.tfmonop">
		<![CDATA[
			select
				sum(
					IF(tf.LEVEL = 6, tz.MONOPOLY,
					IF(tf.LEVEL >= 4, tz.MONOPOLY / 2,
					IF(tf.LEVEL >= 1, tz.PRESENCE, 0))))
			from trade_fleet tf
				inner join r_province p on tf.R_PROVINCE = p.NAME
				inner join R_PROVINCE_TZ tz on tz.ID = p.ID
			where tf.R_COUNTRY = ':countryName'
				AND tf.ID_GAME = :idGame
		;
		]]>
	</entry>
	<entry key="counter.tradeCenter">
		<![CDATA[
			select
				c.TYPE as TYPE,
				peu.R_COUNTRY as COUNTRY
			from counter c
				inner join stack s on c.ID_STACK = s.ID
				inner join r_province p on s.R_PROVINCE = p.NAME
				inner join r_province_eu peu on p.ID = peu.ID
			where type like 'TRADE_CENTER%'
				AND s.ID_GAME = :idGame
		;
		]]>
	</entry>
	<entry key="income.colTp">
		<![CDATA[
			select
				c.COLONY as COL,
				sum(
					IF(c.COLONY,
						LEVEL + IF(LEVEL >=4, 2, IF(LEVEL >= 1, 1, 0)) * r.INCOME,
						IF(LEVEL >= 4,
							2,
							IF(LEVEL >=1, 1, .0)))) as INCOME
			from colony c
				inner join r_region r on c.R_REGION = r.NAME
				inner join counter c0 on c.ID_COUNTER = c0.ID
				inner join stack s on c0.ID_STACK = s.id
			where c0.R_COUNTRY = ':countryName'
				and s.ID_GAME = :idGame
			group by c.COLONY
		;
		]]>
	</entry>
	<entry key="income.exoRes">
		<![CDATA[
			select
				sum(price)
			from (
  				select
  					sum(er.NUMBER) * substr(s.R_PROVINCE, 6, 1) as price
  				from exotic_resources er
  					inner join colony c on er.ID_COLONY = c.ID
  					inner join counter c0 on c.ID_COUNTER = c0.ID
  					inner join counter c1 on c1.type = concat(er.RESOURCE, '_PRICE')
  					inner join stack s on c1.ID_STACK = s.ID
  				where c0.R_COUNTRY = ':countryName'
  					and s.ID_GAME = :idGame
  				group by er.RESOURCE, s.R_PROVINCE
			) as t
		;
		]]>
	</entry>
</properties>