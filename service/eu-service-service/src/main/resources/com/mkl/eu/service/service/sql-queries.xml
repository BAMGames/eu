<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
    <entry key="income.NationalProvinces">
        <![CDATA[
			select
				p.NAME as PROVINCE,
				peu.INCOME as INCOME
			from r_province_eu peu
				inner join r_province p on peu.id = p.id
			where R_COUNTRY = ':countryName'
				and  p.name not in
					(select
						s.R_PROVINCE
					from counter c
						inner join stack s on c.ID_STACK = s.id
					where c.R_COUNTRY <> ':countryName'
						and s.ID_GAME = :idGame
						and c.TYPE = 'OWN'
					)
			;
		]]>
    </entry>
    <entry key="income.OwnedProvinces">
        <![CDATA[
			select
				s.R_PROVINCE as PROVINCE,
				peu.income as INCOME
			from counter c
				inner join stack s on c.ID_STACK = s.id
				inner join r_province p on p.name = s.r_province
				inner join r_province_eu peu on peu.id = p.id
			where c.R_COUNTRY = ':countryName'
				and s.ID_GAME = :idGame
				and c.type = 'OWN'
			;
		]]>
    </entry>
    <entry key="income.PillagedProvinces">
        <![CDATA[
			select
				s.R_PROVINCE as PROVINCE
			from counter c
				inner join stack s on c.ID_STACK = s.id
			where (c.TYPE = 'REVOLT_MINUS'
					OR c.TYPE = 'REVOLT_PLUS'
					OR c.TYPE = 'PILLAGE_MINUS'
					OR c.TYPE = 'PILLAGE_PLUS'
					OR c.TYPE = 'SIEGEWORK_MINUS'
					OR c.TYPE = 'CONTROL')
				AND s.ID_GAME = :idGame
				AND s.R_PROVINCE in :provinceNames
			;
		]]>
    </entry>
	<entry key="income.mnu">
		<![CDATA[
			select
				sum(m.value)
			from counter c
				inner join stack s on c.ID_STACK = s.ID
				inner join t_mnu m on m.R_COUNTRY = c.R_COUNTRY and m.TYPE = c.TYPE
			where s.ID_GAME = :idGame
				AND c.R_COUNTRY = ':countryName'
				AND s.R_PROVINCE not in :provinceNames
			;
		]]>
	</entry>
	<entry key="income.innergold">
		<![CDATA[
			select
				sum(g.value)
			from r_gold g
			where g.R_PROVINCE in :provinceNames;
		]]>
	</entry>
	<entry key="income.outergold">
		<![CDATA[
			select
				20 * count(*)
			from counter c
				inner join stack s on c.ID_STACK = s.ID
			where s.ID_GAME = :idGame
				AND s.R_PROVINCE in :provinceNames
				AND c.TYPE = 'GOLD_MINE'
			;
		]]>
	</entry>
	<entry key="income.tflevels">
		<![CDATA[
			select
				sum(tf.level * (CASE tz.TYPE WHEN 'ZP' THEN 2 ELSE 1 END))
			from trade_fleet tf
				inner join r_province p on tf.R_PROVINCE = p.NAME
				inner join R_PROVINCE_TZ tz on tz.ID = p.ID
			where tf.R_COUNTRY = ':countryName'
				AND tf.ID_GAME = :idGame
		;
		]]>
	</entry>
	<entry key="income.tfmonop">
		<![CDATA[
			select
				sum(
					CASE
        				WHEN tf.LEVEL = 6 THEN tz.MONOPOLY
        				WHEN tf.LEVEL >= 4 THEN tz.MONOPOLY / 2
        				WHEN tf.LEVEL >= 1 THEN tz.PRESENCE
        				ELSE 0
        			END
        		)
			from trade_fleet tf
				inner join r_province p on tf.R_PROVINCE = p.NAME
				inner join R_PROVINCE_TZ tz on tz.ID = p.ID
			where tf.R_COUNTRY = ':countryName'
				AND tf.ID_GAME = :idGame
		;
		]]>
	</entry>
	<entry key="counter.tradeCenter">
		<![CDATA[
			select
				c.TYPE as TYPE,
				peu.R_COUNTRY as COUNTRY
			from counter c
				inner join stack s on c.ID_STACK = s.ID
				inner join r_province p on s.R_PROVINCE = p.NAME
				inner join r_province_eu peu on p.ID = peu.ID
			where type like 'TRADE_CENTER%'
				AND s.ID_GAME = :idGame
		;
		]]>
	</entry>
	<entry key="income.colTp">
		<![CDATA[
			select
				c.COLONY as COL,
				sum(
					IF(c.COLONY,
						LEVEL + IF(LEVEL >=4, 2, IF(LEVEL >= 1, 1, 0)) * r.INCOME,
						IF(LEVEL >= 4,
							2,
							IF(LEVEL >=1, 1, .0)))) as INCOME
			from colony c
				inner join r_region r on c.R_REGION = r.NAME
				inner join counter c0 on c.ID_COUNTER = c0.ID
				inner join stack s on c0.ID_STACK = s.id
			where c0.R_COUNTRY = ':countryName'
				and s.ID_GAME = :idGame
			group by c.COLONY
		;
		]]>
	</entry>
	<entry key="income.exoRes">
		<![CDATA[
			select
				sum(price)
			from (
  				select
  					sum(er.NUMBER) * substr(s.R_PROVINCE, 6, 1) as price
  				from exotic_resources er
  					inner join colony c on er.ID_COLONY = c.ID
  					inner join counter c0 on c.ID_COUNTER = c0.ID
  					inner join counter c1 on c1.type = concat(er.RESOURCE, '_PRICE')
  					inner join stack s on c1.ID_STACK = s.ID
  				where c0.R_COUNTRY = ':countryName'
  					and s.ID_GAME = :idGame
  				group by er.RESOURCE, s.R_PROVINCE
			) as t
		;
		]]>
	</entry>
	<entry key="game.ownedProvinces">
		<![CDATA[
			select
				p.NAME as PROVINCE
			from r_province_eu peu
				inner join r_province p on peu.id = p.id
			where R_COUNTRY = ':countryName'
				and  p.name not in
					(select
						s.R_PROVINCE
					from counter c
						inner join stack s on c.ID_STACK = s.id
					where c.R_COUNTRY <> ':countryName'
						and s.ID_GAME = :idGame
						and (c.TYPE = 'OWN')
					)
			UNION
			select
				s.R_PROVINCE as PROVINCE
			from counter c
				inner join stack s on c.ID_STACK = s.id
				inner join r_province p on p.name = s.r_province
				inner join r_province_eu peu on peu.id = p.id
			where c.R_COUNTRY = ':countryName'
				and s.ID_GAME = :idGame
				and c.type = 'OWN'
			;
		]]>
	</entry>
	<entry key="colony.inlandAdvance.rotw">
		<![CDATA[
			select
				distinct c.R_COUNTRY
			FROM r_province_rotw pr
  				INNER JOIN r_province p ON pr.id = p.id
 				LEFT OUTER JOIN STACK s ON s.R_PROVINCE = p.NAME
 				LEFT OUTER JOIN COUNTER c ON c.ID_STACK = s.ID
    		WHERE s.ID_GAME = :idGame
    			AND (c.TYPE = 'COLONY_PLUS' OR c.TYPE = 'MISSION')
    			AND pr.region IN (
  					SELECT
  						DISTINCT pr1.region
  					FROM r_province_rotw pr
    					INNER JOIN r_province p ON pr.id = p.id
    					INNER JOIN r_border b1 ON b1.ID_R_PROVINCE_FROM = p.ID
    					INNER JOIN r_province p1 ON b1.ID_R_PROVINCE_TO = p1.ID
    					INNER JOIN r_province_rotw pr1 ON pr1.ID = p1.ID
  					WHERE pr.region = (
    					SELECT
    						pr.REGION
    				FROM r_province_rotw pr
      					INNER JOIN r_province p ON pr.id = p.id
    				WHERE p.name = ':province'
  					)
				)
			;
		]]>
	</entry>
	<entry key="colony.inlandAdvance.eu">
		<![CDATA[
			SELECT
				DISTINCT IFNULL(c.R_COUNTRY, pe1.R_COUNTRY) as owner
			FROM r_province_rotw pr
  				INNER JOIN r_province p ON pr.id = p.id
  				INNER JOIN r_border b1 ON b1.ID_R_PROVINCE_FROM = p.ID
  				INNER JOIN r_province p1 ON b1.ID_R_PROVINCE_TO = p1.ID
  				INNER JOIN r_province_eu pe1 ON pe1.ID = p1.ID
  				LEFT OUTER JOIN stack s ON s.R_PROVINCE = p1.NAME AND s.ID_GAME = :idGame
  				LEFT OUTER JOIN counter c ON c.ID_STACK = s.ID AND c.TYPE = 'OWN'
			WHERE pr.region = (
  				SELECT
  					pr.REGION
  				FROM r_province_rotw pr
    				INNER JOIN r_province p ON pr.id = p.id
  				WHERE p.name = ':province'
				)
			;
		]]>
	</entry>
	<entry key="tp.others_region">
		<![CDATA[
			SELECT
				COUNT(*) AS NUMBER
			FROM counter c
				INNER JOIN stack s ON c.ID_STACK = s.ID
				INNER JOIN r_province p ON s.R_PROVINCE = p.NAME
				INNER JOIN r_province_rotw pr ON pr.id = p.id
			WHERE s.ID_GAME = :idGame
				AND c.R_COUNTRY <> ':countryName'
				AND (c.TYPE = 'TRADING_POST_MINUS' OR c.TYPE = 'TRADING_POST_MINUS')
				AND pr.region = ':region'
			;
		]]>
	</entry>
	<entry key="tz.trade_fleet_access_rotw">
		<![CDATA[
			SELECT
				DISTINCT c.R_COUNTRY AS OWNER
			FROM counter c
 				INNER JOIN stack s ON c.ID_STACK = s.ID
			WHERE
				s.ID_GAME = :idGame
  				AND (c.TYPE = 'TRADING_POST_MINUS' OR c.TYPE = 'TRADING_POST_PLUS' OR c.TYPE = 'COLONY_MINUS' OR c.TYPE = 'COLONY_PLUS')
  				AND s.R_PROVINCE IN (
  					SELECT
  						DISTINCT p.NAME
  					FROM r_province_rotw pr
    					INNER JOIN r_province p ON p.ID = pr.ID
    					LEFT OUTER JOIN r_border b ON b.ID_R_PROVINCE_FROM = p.ID
    					INNER JOIN R_PROVINCE p2 ON b.ID_R_PROVINCE_TO = p2.ID
  					WHERE p2.NAME = ':province'
  						OR p2.NAME IN (
    						SELECT
    							p2.NAME
    						FROM r_province_tz ptz
      							INNER JOIN r_province p1 ON ptz.R_PROVINCE = p1.NAME
      							INNER JOIN R_PROVINCE_SEA ps1 ON p1.ID = ps1.ID
      							LEFT OUTER JOIN r_border b ON b.ID_R_PROVINCE_FROM = p1.ID
      							INNER JOIN R_PROVINCE p2 ON b.ID_R_PROVINCE_TO = p2.ID
      							INNER JOIN R_PROVINCE_SEA ps2 ON p2.ID = ps2.ID
    						WHERE ptz.R_PROVINCE = ':province'
  						)
				)
			;
		]]>
	</entry>
	<entry key="game.neighbor_owner">
		<![CDATA[
			SELECT
				DISTINCT IFNULL(C.R_COUNTRY, PE1.R_COUNTRY) AS OWNER
  			FROM R_PROVINCE P
  				INNER JOIN R_BORDER B1 ON B1.ID_R_PROVINCE_FROM = P.ID
  				INNER JOIN R_PROVINCE P1 ON B1.ID_R_PROVINCE_TO = P1.ID
  				INNER JOIN R_PROVINCE_EU PE1 ON PE1.ID = P1.ID
  				LEFT OUTER JOIN STACK S ON S.R_PROVINCE = P1.NAME AND S.ID_GAME = :idGame
  				LEFT OUTER JOIN COUNTER C ON C.ID_STACK = S.ID AND C.TYPE = 'OWN'
			WHERE P.NAME = ':province';
		]]>
	</entry>
</properties>